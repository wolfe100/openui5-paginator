/*
 * Copyright (c) NT-ware ES 2008-2023. All Rights Reserved.
 * Internet : https://www.nt-ware.com
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Control","./library","./PaginatorRenderer"],function(e,t,i,s){"use strict";let a=i.PaginatorEvent;let r=t.extend("syshub.controls.Paginator",{metadata:{library:"syshub.controls",properties:{currentPage:{type:"int",group:"Misc",defaultValue:1},numberOfVisiblePages:{type:"int",group:"Misc",defaultValue:5},entriesAbsolute:{type:"int",group:"Misc",defaultValue:null},entriesPerPage:{type:"int",group:"MISC",defaultValue:100},entriesPerPageSelectionValues:{type:"string",group:"MISC",defaultValue:"10,20,30,40,50,60,70,80,90,100"},entriesPerPageVisible:{type:"boolean",group:"MISC",defaultValue:true},pageHolderWidth:{type:"int",group:"MISC"},showGoto:{type:"boolean",group:"MISC",defaultValue:true},showSpinner:{type:"boolean",group:"Misc",defaultValue:false}},events:{page:{parameters:{srcPage:{type:"int"},targetPage:{type:"int"},offset:{type:"int"},limit:{type:"int"},type:{type:"syshub.controls.PaginatorEvent"}}},entriesPerPageChanged:{parameters:{offset:{type:"int"},limit:{type:"int"}}}}}});r.numberOfPages=null;r.prototype.init=function(){this.bShowAnimation=true;this.busyCount=0};r.prototype.onclick=function(e){this._handleSelect(e)};r.prototype.setCurrentPage=function(e,t){this.setProperty("currentPage",e,t);if(this.getDomRef()){s.updateBackAndForward(this)}return this};r.prototype.triggerPaginatorAnimation=function(){let e=[];let t=[];let i=this.getId();let a=$("#"+i+"-pages").children();let r=this._calculatePagesRange();let n;if(this._oOldRange){n=this._oOldRange}else{n={};let e=a[0].id.split("--");n.firstPage=parseInt(e[e.length-1],10);e=a[a.length-1].id.split("--");n.lastPage=parseInt(e[e.length-1],10)}let g;for(g=r.firstPage;g<=r.lastPage;g++){if(g<n.firstPage||g>n.lastPage){t.push(g)}}let l={firstPage:t[0],lastPage:t[t.length-1]};for(g=n.firstPage;g<=n.lastPage;g++){if(g<r.firstPage||g>r.lastPage){e.push(g)}}this.getDomRef("summary").outerHTML=s.getSummaryHtml(this,this.getCurrentPage());let o=s.getPagesHtml(this.getId(),n,this.getCurrentPage(),true);let u=s.getPagesHtml(this.getId(),l,this.getCurrentPage(),false);if(n.firstPage<l.firstPage){u=o+u}else{u=u+o}let f=document.activeElement;let p=f?f.id:undefined;this.getDomRef("pages").innerHTML=u;if(p){f=$("#"+p)}else{f=$("#testPaginator-a--"+this.getCurrentPage())}$(f).focus();let h=this.getId()+"-li--";this._oOldRange=r;function P(e){let t=$("#"+e);if(t){}}for(g=0;g<e.length;g++){let t=h+e[g];$("#"+t).hide(400,P(this.getId()))}for(g=0;g<t.length;g++){$("#"+h+t[g]).show(400)}};r.prototype._calculatePagesRange=function(){let e=1;let t=this.numberOfPages;let i=this.getCurrentPage();let s;let a;if(Number.isInteger(this.getNumberOfVisiblePages()/2)){s=this.getNumberOfVisiblePages()/2;a=this.getNumberOfVisiblePages()/2-1}else{s=Math.ceil(this.getNumberOfVisiblePages()/2);a=Math.ceil(this.getNumberOfVisiblePages()/2)}if(i<this.getNumberOfVisiblePages()-1){if(t>this.getNumberOfVisiblePages()){t=this.getNumberOfVisiblePages()}}else if(i===t){if(t>=this.getNumberOfVisiblePages()){e=t-this.getNumberOfVisiblePages()+1}}else if(t-i<a){e=t-this.getNumberOfVisiblePages()+1}else{e=i-s;t=i+a}return{firstPage:e,lastPage:t}};r.prototype.onkeydown=function(t){let i=t.getPseudoTypes();if(e.inArray("saptabnext",i)!==-1){this.triggerTabbingNavigation(t,false)}else if(e.inArray("saptabprevious",i)!==-1){this.triggerTabbingNavigation(t,true)}else if(e.inArray("sapincrease",i)!==-1){this.triggerInternalNavigation(t,"next")}else if(e.inArray("sapdecrease",i)!==-1){this.triggerInternalNavigation(t,"previous")}else if(e.inArray("sapenter",i)!==-1){this._handleSelect(t)}};r.prototype.triggerInternalNavigation=function(t,i){let s=e(this.getDomRef()).find(":sapFocusable");let a=e(s).index(t.target);let r,n;if(i==="next"){r=a+1;if(e(t.target).hasClass("cosmosUiPagCurrentPage")){r=r+1}n=s[r];if(n){e(n).focus();t.preventDefault();t.stopPropagation()}}else if(i==="previous"&&s[a-1]){r=a-1;n=s[r];if(n&&e(n).hasClass("cosmosUiPagCurrentPage")){n=s[r-1]}if(n){e(n).focus();t.preventDefault();t.stopPropagation()}}};r.prototype.triggerTabbingNavigation=function(t,i){let s=e(this.getDomRef()).find(":sapFocusable");if(!i){e(s[s.length-1]).focus()}else{let i=e(s).index(t.target);if(i!==0){e(s[0]).focus()}}};r.prototype.getFocusInfo=function(){let e=this.$().find(":focus").attr("id");if(e){return{customId:e}}else{return sap.ui.core.Element.prototype.getFocusInfo.apply(this,arguments)}};r.prototype.applyFocusInfo=function(e){if(e&&e.customId){this.$().find("#"+e.customId).focus()}else{sap.ui.core.Element.prototype.getFocusInfo.apply(this,arguments)}return this};r.prototype._handleSelect=function(e){if(e&&e.target){e.preventDefault();let t=e.target;if(!t.id){t=t.parentNode}if(t.id&&t.id!==this.getId()+"-pages"){let i=t.id.split("--");if(i.length>1){let s=i[i.length-1];let r=null;let n=this.getCurrentPage();let g=n;if(s.match(/^\d+$/)){r=a.Goto;g=parseInt(s,10)}else if(s==="firstPageLink"){r=a.First;g=1}else if(s==="backLink"){r=a.Previous;g=Math.max(n-1,1)}else if(s==="forwardLink"){r=a.Next;g=Math.min(n+1,this.numberOfPages)}else if(s==="lastPageLink"){r=a.Last;g=this.numberOfPages}else if(s==="gotoPageLink"){r=a.Goto;let e=t.id.replace("gotoPageLink","gotoPageValue");let i=document.getElementById(e).value;g=parseInt(i);if(isNaN(g)||g>this.numberOfPages){return}}else if(s==="gotoPageValue"&&e.keyCode===13){r=a.Goto;let e=t.id.replace("gotoPageLink","gotoPageValue");let i=document.getElementById(e).value;g=parseInt(i);if(isNaN(g)||g>this.numberOfPages){return}}else if(s==="entriesPerPageSelection"){let t=e.target.options.selectedIndex;let i=parseInt(e.target.options[t].value);if(i!==this.getEntriesPerPage()){this.setEntriesPerPage(i);this.fireEntriesPerPageChanged({offset:(g-1)*this.getEntriesPerPage(),limit:this.getEntriesPerPage()})}}if(g!==n){if(this.bShowAnimation){this.setCurrentPage(g,true);this.triggerPaginatorAnimation()}else{this.setCurrentPage(g)}this.firePage({srcPage:n,targetPage:g,offset:(g-1)*this.getEntriesPerPage(),limit:this.getEntriesPerPage(),type:r})}}}}};r.prototype.setShowSpinner=function(e){if(e){$("#"+this.getId()+"--busyIndicator").attr("style","visibility:visible")}else{$("#"+this.getId()+"--busyIndicator").attr("style","visibility:hidden")}};return r},true);